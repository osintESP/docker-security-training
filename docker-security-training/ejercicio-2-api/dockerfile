# 1. BASE IMAGE: Usamos una imagen base ligera y específica
FROM python:3.11-slim

# 2. DIRECTORIO DE TRABAJO
WORKDIR /app

# 3. CREAR UN USUARIO NO ROOT: El paso de seguridad más importante
#    Creamos el grupo 'appgroup' y el usuario 'appuser'
#    Nota: -S para usuario/grupo de sistema (sin shell/password)
RUN groupadd -r appgroup && useradd -r -g appgroup -s /bin/false appuser

# 4. Copiar dependencias e instalarlas
#    Usamos 'pip install --no-cache-dir' para reducir el tamaño de la imagen final.
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# 5. Copiar el código de la aplicación
COPY api.py .

# 6. ESTABLECER EL USUARIO NO ROOT: Aplicación del Mínimo Privilegio
#    A partir de aquí, el proceso se ejecuta como 'appuser', no como 'root'.
USER appuser

# 7. EXPOSURE: Documentamos el puerto (no tiene efecto de firewall)
EXPOSE 5000

# 8. COMANDO DE INICIO
CMD ["python", "api.py"]