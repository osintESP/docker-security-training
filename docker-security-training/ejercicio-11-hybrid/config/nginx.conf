events {
    worker_connections 1024;
}

http {
    include /opt/nginx/conf/mime.types;
    default_type application/octet-stream;

    # Logging - using paths that exist in openquantumsafe/nginx
    access_log /opt/nginx/logs/access.log;
    error_log /opt/nginx/logs/error.log;

    server {
        listen 4433 ssl;
        server_name localhost;

        # SSL Certificates (Standard ECDSA for browser compatibility)
        ssl_certificate /etc/nginx/ssl/server.crt;
        ssl_certificate_key /etc/nginx/ssl/server.key;

        # Enable TLS 1.3 (required for post-quantum key exchange)
        ssl_protocols TLSv1.3 TLSv1.2;
        
        # TLS 1.3 ciphers are negotiated automatically and don't need explicit configuration
        # For TLS 1.2, we allow ECDSA ciphers (matching our certificate)
        ssl_prefer_server_ciphers off;

        # Post-Quantum Hybrid Key Exchange Configuration
        # The openquantumsafe/nginx image may have PQC groups enabled by default
        # Not restricting groups - let nginx negotiate the best available
        # (including any PQC groups like kyber768, mlkem768, etc.)

        # Security headers
        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-Frame-Options "SAMEORIGIN" always;

        location / {
            root /usr/share/nginx/html;
            index index.html;
            
            # Enable CORS for demo purposes
            add_header Access-Control-Allow-Origin "*" always;
        }
    }
}
